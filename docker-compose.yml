version: "3.8"

services:
  app:
    image: artist-portfolio:latest
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      # Admin credentials
      - ADMIN_EMAIL=${ADMIN_EMAIL:-admin@artist.com}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}

      # JWT secret for authentication
      - JWT_SECRET=${JWT_SECRET:-change-this-secret-key-in-production}

      # Base URL
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}

      # Node environment
      - NODE_ENV=production

    volumes:
      # Database persistence
      - portfolio_db:/app/db

      # File uploads (public directory)
      - portfolio_uploads:/app/public/uploads

    restart: unless-stopped

    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:3000/",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  # Named volume for database persistence
  portfolio_db:
    driver: local

  # Named volume for file uploads
  portfolio_uploads:
    driver: local

# Optional: Add a reverse proxy with SSL
# Uncomment if you want nginx with automatic SSL
#
# nginx:
#   image: nginx:alpine
#   ports:
#     - "80:80"
#     - "443:443"
#   volumes:
#     - ./nginx.conf:/etc/nginx/nginx.conf:ro
#     - ./ssl:/etc/nginx/ssl:ro
#   depends_on:
#     - app
#   restart: unless-stopped
