version: "3.8"

# Example production docker-compose.yml using DockerHub image
# Replace 'yourusername' with your actual DockerHub username

services:
  app:
    # Use DockerHub image instead of building locally
    image: yourusername/artist-portfolio:1.1.0
    # Or use latest tag:
    # image: yourusername/artist-portfolio:latest
    
    # Remove the build section when using DockerHub image
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    
    ports:
      - "3000:3000"
    environment:
      # Admin credentials
      - ADMIN_EMAIL=${ADMIN_EMAIL:-admin@artist.com}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}

      # JWT secret for authentication
      - JWT_SECRET=${JWT_SECRET:-change-this-secret-key-in-production}

      # Base URL
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}

      # Node environment
      - NODE_ENV=production

    volumes:
      # Database persistence
      - portfolio_db:/app/db

      # File uploads (public directory)
      - portfolio_uploads:/app/public/uploads

    restart: unless-stopped

    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:3000/",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  # Named volume for database persistence
  portfolio_db:
    driver: local

  # Named volume for file uploads
  portfolio_uploads:
    driver: local

